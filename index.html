<!DOCTYPE html>
<html>
<head>
    <title>Renewal Request</title>
    <script>
        async function handleSubmit() {
            const urlParams = new URLSearchParams(window.location.search);
            const contactid = urlParams.get('contactid');

            if (contactid) {
                try {
                    const response = await fetch("https://5d94718007a1e4989f9274a896dff6.a8.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/9cd3356925504f168a77589ac473444d/triggers/manual/paths/invoke/?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=k7AakpDuU28zMISM6khqObMA1A_4TVMfTWwUAEJ1Drw", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({ contactid })
                    });

                    if (response.ok) {
                        document.getElementById("message").innerText = "Your request has been received. We’ll be in touch with your quote!";
                        document.getElementById("submitBtn").style.display = "none";
                    } else {
                        document.getElementById("message").innerText = "Something went wrong. Please try again.";
                        console.error("Error from Power Automate:", await response.text());
                    }
                } catch (e) {
                    document.getElementById("message").innerText = "Network error. Please try again later.";
                    console.error("Fetch error:", e);
                }
            } else {
                document.getElementById("message").innerText = "Missing contact ID. Please use the link provided in your email.";
            }
        }
    </script>
</head>
<body>
    <h2 id="message">Hit 'Submit' and we’ll be in touch with your quote!</h2>
    <button id="submitBtn" onclick="handleSubmit()" style="padding:10px 20px;font-size:16px;border-radius:5px;background-color:#0078d4;color:white;border:none;">
        Submit
    </button>
</body>
</html>
