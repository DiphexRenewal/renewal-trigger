<script>
(function () {
  // Read params from the URL
  const qs = new URLSearchParams(location.search);
  const contactid = qs.get('contactid');
  const eid       = qs.get('eid');

  // Your DEV endpoint (same URL you provided)
  const endpoint = 'https://30258aec3152eb969baf613b392853.a6.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/29730e5e96c6455dbf850240d8a5844f/triggers/manual/paths/invoke/?api-version=1';

  // Elements
  const btn = document.getElementById('submitBtn');
  const msg = document.getElementById('msg') || document.getElementById('status');

  if (!btn) return;

  btn.addEventListener('click', function () {
    btn.disabled = true;
    if (msg) msg.textContent = 'Submitting…';

    // Build the POSTs we need to make (whichever params are present)
    const calls = [];
    if (contactid) {
      calls.push(fetch(endpoint, {
        method: 'POST',
        mode: 'no-cors',                 // avoid CORS preflight
        body: JSON.stringify({ contactid })
      }));
    }
    if (eid) {
      calls.push(fetch(endpoint, {
        method: 'POST',
        mode: 'no-cors',
        body: JSON.stringify({ eid })
      }));
    }

    // Fire the requests and then show success
    Promise.allSettled(calls).then(() => {
      if (msg) msg.textContent = 'Thanks — your request was received. We will send a quote shortly.';
    }).catch(() => {
      // Even if something throws here, keep UX positive
      if (msg) msg.textContent = 'Thanks — your request was received. We will send a quote shortly.';
    });
  });
})();
</script>
