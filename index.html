<script>
(function () {
  // Read params from the URL
  const qs = new URLSearchParams(location.search);
  const contactid = qs.get('contactid');   // used by renewal flow
  const eid       = qs.get('eid');         // used by email-status flow

  // 1) Renewal flow (contactid) – YOUR URL
  const renewalEndpoint =
    'https://30258aec3152eb969baf613b392853.a6.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/643327d14b1b4518a9d5d67902066e8e/triggers/manual/paths/invoke/?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=ol4X8anCSGgQJZ8ITkTWJfBIp1p_DsnifBiB_D58aH8';

  // 2) Email status flow (eid) – leave as-is
  const emailStatusEndpoint =
    'https://30258aec3152eb969baf613b392853.a6.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/29730e5e96c6455dbf850240d8a5844f/triggers/manual/paths/invoke/?api-version=1';

  // UI elements
  const btn = document.getElementById('submitBtn');
  const msg = document.getElementById('msg') || document.getElementById('status');

  if (!btn) return;

  btn.addEventListener('click', function () {
    btn.disabled = true;
    if (msg) msg.textContent = 'Submitting…';

    const calls = [];

    // Hit renewal flow if we have a contactid
    if (contactid) {
      calls.push(fetch(renewalEndpoint, {
        method: 'POST',
        mode: 'no-cors',                 // avoid CORS preflight
        body: JSON.stringify({ contactid })
      }));
    }

    // Hit email-status flow if we have an eid
    if (eid) {
      calls.push(fetch(emailStatusEndpoint, {
        method: 'POST',
        mode: 'no-cors',
        body: JSON.stringify({ eid })
      }));
    }

    // We can’t read responses in no-cors; assume success once posts are fired
    Promise.allSettled(calls)
      .then(() => {
        if (msg) msg.textContent = 'Thanks — your request was received. We will send a quote shortly.';
      })
      .catch(() => {
        if (msg) msg.textContent = 'Thanks — your request was received. We will send a quote shortly.';
      });
  });
})();
</script>
